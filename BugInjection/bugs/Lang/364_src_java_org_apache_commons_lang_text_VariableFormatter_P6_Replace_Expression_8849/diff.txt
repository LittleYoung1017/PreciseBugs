--- /VariableFormatter.java	2023-07-04 02:09:48.240722581 +0000
+++ /Lang-65/src/java/org/apache/commons/lang/text/VariableFormatter.java	2023-07-04 02:09:48.240722581 +0000
@@ -361,7 +361,7 @@
          * @return the next token or <b>null</b> if the end is reached
          */
         protected FieldPosition nextToken(char[] data) {
-            if (getTokenList().isEmpty()) {
+if  ( endLen = getVarEndMatcher (  ) .isMatch ( data, getPos (  ) , 0, getLength (  )  )  <= 0 )  {
                 if (!hasNext()) {
                     // end of data is reached
                     return null;
